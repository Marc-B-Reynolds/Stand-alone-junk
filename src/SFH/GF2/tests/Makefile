# Dumb mini makefile:
# 0) assumes clang/GCC like options
# 1) every .c file is to be built into an executable

# if CC is the default (not environment varible nor supplied to make, then default
ifeq ($(origin CC),default)
  CC = clang-15
endif

IDIRS  = -I../.. -I..
CFLAGS = -g -O3 -flto ${IDIRS} -march=native -Wall -Wextra -Wconversion -Wpedantic -Wno-unused-function
LDLIBS = -lbmat

# add filtering into two groups w/o and w m4ri
SRC     := ${wildcard *.c}
HEADERS := ${wildcard *.h}
TARGETS := ${SRC:.c=}

all:    ${TARGETS}

spew:
	@echo ${CC}

clean:
	-${RM} ${TARGETS}

distclean:	clean
	-${RM} .makedep *~

.makedep:
	@-echo "building dependencies"
	@-echo "# autogenerated by Makefile" > .makedep
	@$(foreach file, $(SRC), ${CC} ${IDIRS} -MM -MQ${file:.c=}  $(file) >> .makedep;)

# anything with a m4ri suffix requires m4ri
%_m4ri: %_m4ri.c Makefile  ../libbmat.a
	${CC} ${CFLAGS} $< -L.. ${LDLIBS} -lm4ri -o $@

%:%.c	Makefile ../libbmat.a
	${CC} ${CFLAGS} $< -L.. ${LDLIBS} -o $@

-include .makedep
